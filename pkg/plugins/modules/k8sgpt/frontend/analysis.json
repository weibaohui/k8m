{
  "type": "page",
  "title": "K8sGPT资源分析",
  "body": [
    {
      "type": "form",
      "title": "分析配置",
      "mode": "inline",
      "target": "analysisTable",
      "submitText": "执行分析",
      "body": [
        {
          "type": "select",
          "name": "cluster",
          "label": "集群",
          "placeholder": "选择集群",
          "source": "get:/params/cluster/option_list",
          "searchable": true,
          "clearable": true,
          "required": true,
          "value": "${''|selectedCluster}",
          "onEvent": {
            "change": {
              "actions": [
                {
                  "actionType": "custom",
                  "script": "window.setCurrentClusterId(event.data.value || '')"
                }
              ]
            }
          }
        },
        {
          "type": "select",
          "name": "kind",
          "label": "资源类型",
          "placeholder": "选择资源类型",
          "clearable": true,
          "options": [
            {
              "label": "Pod",
              "value": "Pod"
            },
            {
              "label": "Deployment",
              "value": "Deployment"
            },
            {
              "label": "Service",
              "value": "Service"
            },
            {
              "label": "ReplicaSet",
              "value": "ReplicaSet"
            },
            {
              "label": "PersistentVolumeClaim",
              "value": "PersistentVolumeClaim"
            },
            {
              "label": "Ingress",
              "value": "Ingress"
            },
            {
              "label": "StatefulSet",
              "value": "StatefulSet"
            },
            {
              "label": "CronJob",
              "value": "CronJob"
            },
            {
              "label": "Node",
              "value": "Node"
            },
            {
              "label": "ValidatingWebhookConfiguration",
              "value": "ValidatingWebhookConfiguration"
            },
            {
              "label": "MutatingWebhookConfiguration",
              "value": "MutatingWebhookConfiguration"
            },
            {
              "label": "HorizontalPodAutoScaler",
              "value": "HorizontalPodAutoScaler"
            },
            {
              "label": "PodDisruptionBudget",
              "value": "PodDisruptionBudget"
            },
            {
              "label": "NetworkPolicy",
              "value": "NetworkPolicy"
            }
          ]
        },
        {
          "type": "select",
          "name": "namespace",
          "label": "命名空间",
          "searchable": true,
          "clearable": true,
          "source": {
            "method": "get",
            "url": "/k8s/ns/option_list",
            "data": {
              "__cluster": "${ ''|selectedCluster}"
            }
          },
          "disabledOn": "!this.cluster && !''|selectedCluster"
        }
      ]
    },
    {
      "type": "divider"
    },
    {
      "type": "crud",
      "name": "analysisTable",
      "id": "analysisTable",
      "api": {
        "method": "get",
        "url": "/k8s/cluster/${cluster}/plugins/k8sgpt/k8s_gpt/kind/${kind}/run",
        "data": {
          "ns": "$namespace"
        }
      },
      "autoFillHeight": true,
      "autoGenerateFilter": false,
      "headerToolbar": [
        {
          "type": "columns-toggler",
          "align": "right",
          "draggable": true,
          "icon": "fas fa-cog",
          "overlay": true
        },
        "reload"
      ],
      "footerToolbar": [
        {
          "type": "pagination",
          "align": "right"
        },
        {
          "type": "switch-per-page",
          "align": "right"
        }
      ],
      "columns": [
        {
          "name": "kind",
          "label": "资源类型",
          "type": "text",
          "width": 150
        },
        {
          "name": "name",
          "label": "资源名称",
          "type": "text",
          "width": 200
        },
        {
          "name": "error",
          "label": "问题",
          "type": "tpl",
          "tpl": "${error|length} 个问题",
          "width": 100
        },
        {
          "name": "details",
          "label": "详情",
          "type": "tpl",
          "tpl": "${details}",
          "popOver": {
            "title": "完整详情",
            "body": "<pre>${details}</pre>",
            "showIcon": false
          }
        }
      ]
    }
  ]
}
