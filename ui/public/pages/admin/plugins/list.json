{
    "type": "page",
    "title": "插件管理",
    "body": [
        {
            "type": "crud",
            "id": "pluginCRUD",
            "name": "pluginCRUD",
            "autoFillHeight": true,
            "autoGenerateFilter": {
                "columnsNum": 4,
                "showBtnToolbar": false
            },
            "headerToolbar": [
                "reload",
                "bulkActions"
            ],
            "api": "get:/admin/plugin/list",
            "columns": [
                {
                    "type": "operation",
                    "label": "操作",
                    "buttons": [
                        {
                            "type": "button",
                            "icon": "fas fa-check-double text-primary",
                            "actionType": "ajax",
                            "label": "安装",
                            "visibleOn": "this.status == '已发现'",
                            "confirmText": "确认安装该插件？",
                            "api": "post:/admin/plugin/install/${name}"
                        },
                        {
                            "type": "button",
                            "icon": "fas fa-play-circle text-success",
                            "actionType": "ajax",
                            "label": "启用",
                            "visibleOn": "this.status == '已安装' || this.status == '已禁用'",
                            "confirmText": "确认启用该插件？",
                            "api": "post:/admin/plugin/enable/${name}"
                        },
                        {
                            "type": "button",
                            "icon": "fas fa-stop-circle text-warning",
                            "actionType": "ajax",
                            "label": "关闭",
                            "visibleOn": "this.status == '已启用'",
                            "confirmText": "确认关闭该插件？",
                            "api": "post:/admin/plugin/disable/${name}"
                        },
                        {
                            "type": "button",
                            "icon": "fas fa-trash text-danger",
                            "actionType": "ajax",
                            "label": "卸载",
                            "visibleOn": "this.status == '已禁用'",
                            "confirmText": "确认卸载该插件？卸载后需要重新注册才可再次安装。",
                            "api": "post:/admin/plugin/uninstall/${name}"
                        },
                        {
                            "type": "button",
                            "icon": "fas fa-level-up-alt text-info",
                            "actionType": "ajax",
                            "label": "升级",
                            "visibleOn": "this.canUpgrade && this.status != '已发现'",
                            "confirmText": "确认升级该插件？",
                            "api": "post:/admin/plugin/upgrade/${name}"
                        },
                        {
                            "type": "button",
                            "icon": "fas fa-clock text-info",
                            "actionType": "drawer",
                            "label": "定时任务",
                            "drawer": {
                                "closeOnEsc": true,
                                "closeOnOutside": true,
                                "size": "lg",
                                "title": "插件定时任务 (${title})",
                                "body": [
                                    {
                                        "type": "crud",
                                        "api": "get:/admin/plugin/cron/${name}",
                                        "quickSaveItemApi": "/admin/plugin/cron/name/${name}/spec/${spec|base64Encode}/enabled/${registered}",
                                        "syncLocation": false,
                                        "loadDataOnce": false,
                                        "headerToolbar": [
                                            "reload"
                                        ],
                                        "columns": [
                                            {
                                                "name": "spec",
                                                "label": "Cron表达式"
                                            },
                                            {
                                                "name": "registered",
                                                "label": "生效",
                                                "type": "switch",
                                                "onText": "开启",
                                                "offText": "关闭",
                                                "quickEdit": {
                                                    "mode": "inline",
                                                    "type": "switch",
                                                    "saveImmediately": true,
                                                    "resetOnFailed": true
                                                }
                                            },
                                            {
                                                "name": "next",
                                                "label": "下次执行"
                                            },
                                            {
                                                "name": "prev",
                                                "label": "上次执行"
                                            },
                                            {
                                                "name": "running",
                                                "label": "运行中",
                                                "type": "mapping",
                                                "map": {
                                                    "true": "<span class='label label-success'>是</span>",
                                                    "false": "<span class='label label-default'>否</span>"
                                                }
                                            },
                                            {
                                                "type": "operation",
                                                "label": "操作",
                                                "buttons": [
                                                    {
                                                        "type": "button",
                                                        "icon": "fas fa-bolt text-primary",
                                                        "label": "执行一次",
                                                        "actionType": "ajax",
                                                        "api": "post:/admin/plugin/cron/${name}/run_once?spec=${spec}"
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        },
                        {
                            "type": "button",
                            "icon": "fas fa-info-circle text-info",
                            "actionType": "dialog",
                            "label": "详情",
                            "dialog": {
                                "closeOnEsc": true,
                                "closeOnOutside": true,
                                "size": "lg",
                                "title": "插件详情 （ESC 关闭）",
                                "body": [
                                    {
                                        "type": "static",
                                        "name": "name",
                                        "label": "标识"
                                    },
                                    {
                                        "type": "static",
                                        "name": "title",
                                        "label": "名称"
                                    },
                                    {
                                        "type": "static",
                                        "name": "version",
                                        "label": "版本",
                                        "tpl": "插件：${version}，数据库：${dbVersion|default:-}"
                                    },
                                    {
                                        "type": "static",
                                        "name": "description",
                                        "label": "描述"
                                    },
                                    {
                                        "type": "static",
                                        "name": "status",
                                        "label": "状态"
                                    },
                                    {
                                        "type": "table",
                                        "title": "菜单列表",
                                        "source": "${menus}",
                                        "columns": [
                                            {
                                                "name": "menu",
                                                "label": "菜单",
                                                "type": "tpl",
                                                "tpl": "${icon ? `<i class='${icon}'></i> ` : ''}${title}"
                                            },
                                            {
                                                "name": "eventType",
                                                "label": "点击",
                                                "type": "tpl",
                                                "tpl": "${customEvent?customEvent:url}"
                                            },
                                            {
                                                "name": "order",
                                                "label": "排序"
                                            }
                                        ]
                                    }
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "title",
                    "label": "名称"
                },
                {
                    "type": "tpl",
                    "name": "version",
                    "label": "版本",
                    "tpl": "<span class='label label-default'>插&nbsp;&nbsp;&nbsp;&nbsp;件</span> ${version} <br><span class='label label-info'>数据库</span> ${dbVersion|default:-}"
                },
                {
                    "name": "description",
                    "label": "描述"
                },
                {
                    "name": "status",
                    "label": "状态",
                    "type": "mapping",
                    "map": {
                        "已发现": "<span class='label label-info'>已发现</span>",
                        "已安装": "<span class='label label-default'>已安装</span>",
                        "已启用": "<span class='label label-success'>已启用</span>",
                        "已禁用": "<span class='label label-warning'>已禁用</span>",
                        "未知": "<span class='label label-danger'>未知</span>"
                    }
                }
            ],
            "bulkActions": []
        }
    ]
}